---
tags:
  - typescript
  - nestjs
  - openapi
  - apidocs
---

## NestJS OpenAPI Docs Tests

Writing front-end code to talk to a back-end is so much easier with an autogenerated client. We can use an OpenAPI spec document to generate this client code.

But how do we check that we aren't breaking the clients that the front-end code relies on when changing the back end?

When using nestjs it is easy to add annotations which will generate the OpenAPI spec document. But to test that we are producing the document we expect, and to check that we don't accidentally break something, we can write a unit test to check the document is correct.

This also has the advantage of documenting for the front-end developers what the API looks like.

### Example

After running the [nestjs quickstart](https://docs.nestjs.com/first-steps), then adding the [nestjs OpenAPI bootstrap code](https://docs.nestjs.com/openapi/introduction), we can move the document creation code into its own function:

```ts
function createDocument(app: INestApplication) {
  const options = new DocumentBuilder()
    .setTitle("Cats example")
    .setDescription("The cats API description")
    .setVersion("1.0")
    .addTag("cats")
    .build();
  const document = SwaggerModule.createDocument(app, options);
  return document;
}
```

Then we can write a test to create the doc and check that a section looks as it should:

```ts
it("API docs should match expected", async () => {
  const app = await NestFactory.create(AppModule);
  const docs = createApiDoc(app);
  expect(docs).toMatchObject({
    paths: { "/": { get: { operationId: "AppController_getHello" } } },
  });
});
```

This way we can demonstrate that the API is working as expected, and also document what the API looks like.
